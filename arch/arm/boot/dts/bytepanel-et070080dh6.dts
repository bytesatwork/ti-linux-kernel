/*
 * Copyright (C) 2015 Bytes at Work - http://www.bytesatwork.ch
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include "bytepanel.dtsi"

/ {
	model = "bytePanel ET070080DH6";
	compatible = "batw,bytepanel-et070080dh6", "batw,bytepanel", "batw,m2", "ti,am33xx";

	chosen {
		logo = "logo_baw_800x480_clut224";
	};

	et070080dh6 {
		compatible = "ti,tilcdc,panel";
		status = "okay";
		pinctrl-names = "default";
		pinctrl-0 = <&lcd_pins_s0>;

		panel-info {
			ac-bias           = <255>;
			ac-bias-intrpt    = <0>;
			dma-burst-sz      = <16>;
			bpp               = <32>;
			fdd               = <0x80>;
			sync-edge         = <0>;
			sync-ctrl         = <1>;
			raster-order      = <0>;
			fifo-th           = <0>;
		};

		display-timings {
			native-mode = <&timing0>;
			timing0: 800x480 {
				clock-frequency	= <33250000>;	// should be 33260000, workaround for bug: https://patchwork.kernel.org/patch/4133941/
				hactive		= <800>;
				vactive		= <480>;
				hfront-porch	= <1>;
				hback-porch	= <215>;
				hsync-len	= <40>;
				vback-porch	= <35>;
				vfront-porch	= <8>;
				vsync-len	= <2>;
				hsync-active	= <1>;
				vsync-active	= <1>;
			};
		};
	};
};

&am33xx_pinmux {
	// ---- Display ----
	lcd_pins_s0: lcd_pins_s0 {
		pinctrl-single,pins = <
			PIN_LCD_DATA0		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA1		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA2		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA3		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA4		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA5		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA6		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA7		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA8		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA9		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA10		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA11		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA12		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA13		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA14		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_DATA15		(MUX_MODE0 | PIN_OUTPUT)
			PIN_GPMC_AD8		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data16
			PIN_GPMC_AD9		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data17
			PIN_GPMC_AD10		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data18
			PIN_GPMC_AD11		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data19
			PIN_GPMC_AD12		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data20
			PIN_GPMC_AD13		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data21
			PIN_GPMC_AD14		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data22
			PIN_GPMC_AD15		(MUX_MODE1 | PIN_OUTPUT)	// lcd_data23
			PIN_LCD_VSYNC		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_HSYNC		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_PCLK		(MUX_MODE0 | PIN_OUTPUT)
			PIN_LCD_AC_BIAS_EN	(MUX_MODE0 | PIN_OUTPUT)
		>;
	};

	// ---- Touch ----
	touch_pins: pinmux_touch_pins {
		pinctrl-single,pins = <
			PIN_GPMC_A7		(MUX_MODE7 | PIN_OUTPUT)	// gpio1_23 /wake
			PIN_GPMC_A8		(MUX_MODE7 | PIN_INPUT_PULLUP)	// gpio1_24 /int
		>;
	};
};

// ---- Display ----
&lcdc {
	blue-and-red-wiring = "crossed";
	status = "okay";
};

&lcd_data_enable {
	default-state = "on";
};

&display {
	status = "okay";
};

// ---- Backlight ----
&backlight {
	status = "okay";
};

&epwmss0 {
	status = "okay";
};

&ecap0 {
	status = "okay";
};

// ---- Touch ----
&i2c1 {
	touch: edt-ft5406@38 {
		pinctrl-names = "default";
		pinctrl-0 = <&touch_pins>;

		compatible = "edt,edt-ft5406";
		reg = <0x38>;
		interrupt-parent = <&gpio1>;
		interrupts = <24 0>;
		wake-gpios = <&gpio1 23 GPIO_ACTIVE_HIGH>;
	};
};
