/*
 * Copyright (C) 2015 Bytes at Work - http://www.bytesatwork.ch
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#include "am33xx.dtsi"
#include <dt-bindings/pinctrl/am335x-names.h>

/ {
	model = "byteEngine M2";
	compatible = "batw,m2", "ti,am33xx";

	cpus {
		cpu@0 {
			cpu0-supply = <&vdd1_reg>;
		};
	};

	memory {
		device_type = "memory";
		reg = <0x80000000 0x10000000>;		// 256 MB
	};

	vbat: fixedregulator@0 {
		compatible = "regulator-fixed";
		regulator-name = "vbat";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		regulator-boot-on;
	};

};

&am33xx_pinmux {

	i2c0_pins: pinmux_i2c0_pins {
		pinctrl-single,pins = <
			PIN_I2C0_SDA		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_I2C0_SCL		(PIN_INPUT_PULLUP | MUX_MODE0)
		>;
	};

	nandflash_pins_s0: pinmux_nandflash_pins_s0 {
		pinctrl-single,pins = <
			PIN_GPMC_AD0		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD1		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD2		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD3		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD4		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD5		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD6		(PIN_INPUT_PULLUP | MUX_MODE0)
			PIN_GPMC_AD7		(PIN_INPUT_PULLUP | MUX_MODE0)

			PIN_GPMC_WPN		(PIN_INPUT_PULLUP | MUX_MODE7)
			PIN_GPMC_CSN0		(PIN_OUTPUT | MUX_MODE0)
			PIN_GPMC_ADVN_ALE	(PIN_OUTPUT | MUX_MODE0)
			PIN_GPMC_BEN0_CLE	(PIN_OUTPUT | MUX_MODE0)
			PIN_GPMC_WEN		(PIN_OUTPUT | MUX_MODE0)
			PIN_GPMC_OEN_REN	(PIN_OUTPUT | MUX_MODE0)

			PIN_GPMC_WAIT0		(PIN_INPUT_PULLUP | MUX_MODE0)
		>;
	};
};

&i2c0 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c0_pins>;

	status = "okay";
	clock-frequency = <100000>;

	tps: tps@2d {
		reg = <0x2d>;
	};

	eeprom: eeprom@50 {
		reg = <0x50>;
	};
};

#include "tps65910.dtsi"

&tps {
	vcc1-supply = <&vbat>;
	vcc2-supply = <&vbat>;
	vcc3-supply = <&vbat>;
	vcc4-supply = <&vbat>;
	vcc5-supply = <&vbat>;
	vcc6-supply = <&vbat>;
	vcc7-supply = <&vbat>;
	vccio-supply = <&vbat>;

	regulators {
		vrtc_reg: regulator@0 {
			regulator-always-on;
		};

		vio_reg: regulator@1 {
			regulator-always-on;
		};

		vdd1_reg: regulator@2 {
			regulator-name = "vdd_mpu";
			regulator-min-microvolt = <600000>;
			regulator-max-microvolt = <1500000>;
			regulator-boot-on;
			regulator-always-on;
		};

		vdd2_reg: regulator@3 {
			regulator-name = "vdd_core";
			regulator-min-microvolt = <600000>;
			regulator-max-microvolt = <1500000>;
			regulator-boot-on;
			regulator-always-on;
		};

		vdd3_reg: regulator@4 {
			regulator-always-on;
		};

		vdig1_reg: regulator@5 {
			regulator-always-on;
		};

		vdig2_reg: regulator@6 {
			regulator-always-on;
		};

		vpll_reg: regulator@7 {
			regulator-always-on;
		};

		vdac_reg: regulator@8 {
			regulator-always-on;
		};

		vaux1_reg: regulator@9 {
			regulator-always-on;
		};

		vaux2_reg: regulator@10 {
			regulator-always-on;
		};

		vaux33_reg: regulator@11 {
			regulator-always-on;
		};

		vmmc_reg: regulator@12 {
			regulator-min-microvolt = <1800000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on;
		};
	};
};

&eeprom {
	status = "okay";
	compatible = "at,24c256";
};

&elm {
	status = "okay";
};

&gpmc {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&nandflash_pins_s0>;
	ranges = <0 0 0x08000000 0x10000000>;	// CS0: NAND
	nand: nand@0,0 {
		compatible = "ti,omap2-nand";
		reg = <0 0 4>; /* CS0, offset 0 */
		nand-bus-width = <8>;
		ti,nand-ecc-opt = "ham1";
		ti,elm-id = <&elm>;

		#address-cells = <1>;
		#size-cells = <1>;

		gpmc,device-nand = "true";
		gpmc,device-width = <1>;
		gpmc,sync-clk-ps = <0>;
		gpmc,cs-on-ns = <0>;
		gpmc,cs-rd-off-ns = <44>;
		gpmc,cs-wr-off-ns = <44>;
		gpmc,adv-on-ns = <6>;
		gpmc,adv-rd-off-ns = <34>;
		gpmc,adv-wr-off-ns = <44>;
		gpmc,we-on-ns = <0>;
		gpmc,we-off-ns = <40>;
		gpmc,oe-on-ns = <0>;
		gpmc,oe-off-ns = <54>;
		gpmc,access-ns = <64>;
		gpmc,rd-cycle-ns = <82>;
		gpmc,wr-cycle-ns = <82>;
		gpmc,wait-on-read = "true";
		gpmc,wait-on-write = "true";
		gpmc,bus-turnaround-ns = <0>;
		gpmc,cycle2cycle-delay-ns = <0>;
		gpmc,clk-activation-ns = <0>;
		gpmc,wait-monitoring-ns = <0>;
		gpmc,wr-access-ns = <40>;
		gpmc,wr-data-mux-bus-ns = <0>;
	};
};
